kit-it-koblenz.de, www.kit-it-koblenz.de {

    encode gzip zstd

    @www host www.kit-it-koblenz.de
    redir @www https://kit-it-koblenz.de{uri}

    reverse_proxy kit-website:3000

    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        X-Frame-Options "DENY"
        X-Content-Type-Options "nosniff"
        X-XSS-Protection "1; mode=block"
        Referrer-Policy "strict-origin-when-cross-origin"

        # --- CSP fix f√ºr Next.js ---
        +Content-Security-Policy "
            default-src 'self';
            img-src 'self' data:;
            script-src 'self' 'unsafe-inline';
            style-src 'self' 'unsafe-inline';
            font-src 'self';
            connect-src 'self' https://vitals.vercel-insights.com;
            frame-ancestors 'none';
        "

        Permissions-Policy "
            camera=(),
            microphone=(),
            geolocation=(),
            browsing-topics=()
        "

        Cache-Control "public, max-age=3600"
    }

    @blocked_methods method OPTIONS TRACE TRACK PUT DELETE PATCH CONNECT
    respond @blocked_methods 405
}

